<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>WeeChat + Nginx</title><meta name=description content="Ramblings and tech things"><meta name=keywords content><meta property="og:url" content="https://asynchronous.in/posts/weechat-+-nginx/"><meta property="og:type" content="website"><meta property="og:title" content="WeeChat + Nginx"><meta property="og:description" content="Ramblings and tech things"><meta property="og:image" content="https://asynchronous.in"><meta property="og:image:secure_url" content="https://asynchronous.in"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="WeeChat + Nginx"><meta name=twitter:description content="Ramblings and tech things"><meta property="twitter:domain" content="https://asynchronous.in/posts/weechat-+-nginx/"><meta property="twitter:url" content="https://asynchronous.in/posts/weechat-+-nginx/"><meta name=twitter:image content="https://asynchronous.in"><link rel=canonical href=https://asynchronous.in/posts/weechat-+-nginx/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.edd985581bf860dfb4507e5885197f1680160c7fe19f23b31e183126d99dd596.js integrity="sha256-7dmFWBv4YN+0UH5YhRl/FoAWDH/hnyOzHhgxJtmd1ZY="></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=https://asynchronous.in>maxking's blog</a></div><div class=nav-links><div class=nav-link><a href=https://asynchronous.in/posts/>Posts</a></div><div class=nav-link><a href=https://asynchronous.in/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/maxking><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://asynchronous.in/posts/>Posts</a></li><li class=nav-item><a href=https://asynchronous.in/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/maxking><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>WeeChat + Nginx</h1><small role=doc-subtitle></small><p class=post-date>July 19, 2017</p><ul class=post-tags></ul></div><div class=post-content><p><h1 id=weechat--nginx>WeeChat + Nginx</h1><p>I talked before about different <a href=https://asynchronous.in/2017/03/15/Persistant-IRC-Setup/>solutions for persistent IRC</a> and how I settled on using WeeChat. This post is about how I use the <em>relay</em> feature in WeeChat to interact with it remotely.</p><p>WeeChat has a remote user protocol called as <a href=https://weechat.org/files/doc/devel/weechat_relay_protocol.en.html>relay protocol</a> that people can use to connect WeeChat clients to remote running instances of it. It is helpful when you want to run WeeChat on a remote server and connect using clients from various different places.</p><p>It is very simple to add a new relay to your already running WeeChat:</p><pre><code>/relay add weechat 8080
/set relay.network.password YOURPASSWORD
</code></pre><p>This will make WeeChat listen for clients on TCP port 8080 for incoming connections from clients. In a closed or local environment this might work, but it is must that you use SSL when using it over internet.</p><p>WeeChat allows you to create SSL relays and manages SSL certs too! <a href=https://pthree.org/2016/05/20/weechat-relay-with-lets-encrypt-certificates/>See here</a> for a great introduction to running an SSL relay.</p><p>While there hasnâ€™t been any problem with running weechat over SSL, if you are using the same server for serving some other stuff, it makes managing SSL certificates in two places a little too cumbersome. Also, you need to reload each application after you renew the Lets Encrypt certificate (which is what I use!) in every 90 days.</p><p>So, instead I decided to use Nginx to reverse proxy my WeeChat. Here is the configuration that I use to make it work:</p><pre><code>limit_req_zone $binary_remote_addr zone=weechat:10m rate=5r/m;

map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}

server {

        listen 443 ssl;

        server_name _;
        ssl_certificate /etc/letsencrypt/live/&lt;DOMAIN_NAME&gt;/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/&lt;DOMAIN_NAME&gt;/privkey.pem;

        location ^~ /weechat {
                proxy_pass http://0.0.0.0:8080;
                proxy_http_version 1.1;
                proxy_read_timeout 4h;
                proxy_set_header Connection &quot;upgrade&quot;;
                proxy_set_header Upgrade $http_upgrade;
                limit_req zone=weechat burst=1 nodelay;
        }

}
</code></pre><p>Make sure that you use the correct <code>bind_address</code> and port in the <code>proxy_pass</code> directive above. If you are using a non-standard port like 2000 or 3000 or sometimes even 8080, it is possible that SELinux would deny Nginx access to that port. To allow Nginx access to the ports run the command below:</p><pre><code>$ sudo setsebool httpd_can_network_connect 1 -P
</code></pre><p>That is all, now to connect any WeeChat client, point it to your Domain and port 443 using the password that you set for your relay!</p></p></div><div class=prev-next></div><script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function topFunction(){smoothScrollToTop()}function smoothScrollToTop(){const e=()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;t>0&&(window.requestAnimationFrame(e),window.scrollTo(0,t-t/8))};e()}</script></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>