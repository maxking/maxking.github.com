<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="Abhilash Raj writes here.">


    <meta property="twitter:site" content="@_maxking_">

<meta property="og:site_name" content="maxking&#39;s blog" />
<meta property="og:locale" content="nn_NO" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://asynchronous.in/2013/06/30/rules-and-chains/" />
<meta property="og:title" content="Rules and Chains" />
<meta property="twitter:title" content="Rules and Chains">

    <meta property="twitter:card" content="summary">

<meta property="og:description" content="">
<meta property="twitter:description" content="">
<title>


     maxking&#39;s blog - Rules and Chains 

</title>
<link rel="canonical" href="https://asynchronous.in/2013/06/30/rules-and-chains/">


<style media="screen">
  @font-face {
  font-family: 'Nexa Bold';
  src: url('https://asynchronous.in/fonts/Nexa Bold.otf');
}

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section {
  display: block;
}
body {
  line-height: 1;
}
ol, ul {
  list-style: none;
}
blockquote, q {
  quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
  content: '';
  content: none;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}

*,
*:before,
*:after {
  box-sizing: border-box;
}
a,
a:visited,
a:focus,
a:active {
  text-decoration: none;
}
html {
  height: 100%;
  font-size: 16px;
}
body {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: flex-start;
  -moz-justify-content: flex-start;
  -ms-justify-content: flex-start;
  justify-content: flex-start;
  width: 100%;
  min-height: 100%;
  font-weight: 400;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  color: #111111;
  line-height: 1.6;
  text-rendering: optimizeLegibility !important;
}
.icon {
  text-rendering: geometricPrecision !important;
}
section {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  width: 100%;
}
.container {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  width: 100%;
}
section.header .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
}
section.header .content {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
section.header .container .logo {
  max-width: 100px;
  margin-left: -2em;
}
section.header .name {
  padding-top: 20px;
  font-size: 28px;
  font-family: 'Nexa Bold', 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  text-transform: uppercase;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
  color: #555555;
}
section.header nav {
  margin-bottom: 16px;
}
section.header nav ul {
  list-style: none;
  text-align: center;
  display: -webkit-inline-flex;
  display: -moz-inline-flex;
  display: -ms-inline-flexbox;
  display: -ms-inline-flex;
  display: inline-flex;
}
section.header nav ul a {
  margin-left: 6px;
  margin-right: 6px;
}
section.header nav ul a:first-child {
  margin-left: 0;
}
section.header nav ul a:last-child {
  margin-right: 0;
}
section.header nav ul li {
  color: #555555;
  font-weight: 400;
  font-size: 14px;
  text-transform: uppercase;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  -webkit-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
section.header nav ul li:hover {
  color: #111111;
}
section.footer .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  flex-direction: column-reverse;
  width: 100%;
  text-align: center;
}
section.footer .container a {
  font-size: 14px;
  margin-left: 6px;
  margin-right: 6px;
  opacity: 0.6;
  -webkit-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
section.footer .container a:first-child {
  margin-left: 0;
}
section.footer .container a:last-child {
  margin-right: 0;
}
section.footer .container a:hover {
  opacity: 0.8;
}
section.footer .container a .icon {
  width: 16px;
  height: 16px;
}
section.footer .container .copyright {
  flex-grow: 0.5;
  text-align: start;
}
section.footer .container .icons {
  flex-grow: 0.5;
  text-align: end;
}
section.main .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: flex-start;
  -moz-justify-content: flex-start;
  -ms-justify-content: flex-start;
  justify-content: flex-start;
}
section.main .content {
  color: #111111;
  font-size: 16px;
}
section.main .content .title-container {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: space-between;
  -moz-justify-content: space-between;
  -ms-justify-content: space-between;
  justify-content: space-between;
}
section.main .content .posts {
  margin-bottom: 4em;
}
section.main .content .page-heading {
  font-size: 20px;
  font-weight: 700;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  text-transform: uppercase;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
  margin-bottom: 16px;
}
section.main .content .front-matter .page-heading {
  margin-bottom: 0;
}
section.main .content .front-matter .meta {
  font-size: 14px;
  color: #666666;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  margin-bottom: 32px;
}
section.main .content .front-matter .date,
section.main .content .front-matter .author,
section.main .content .front-matter .tags,
section.main .content .front-matter .word-count,
section.main .content .front-matter .reading-time .middot {
  display: none;
}
section.main .content .front-matter .middot {
  font-size: 6px;
  margin: 0 6px;
  display: inline;
  vertical-align: middle;
}
section.main .content .front-matter .middot:before {
  content: "â€¢";
}
section.main .content .front-matter .tags ul {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
section.main .content .front-matter .tags ul li {
  -webkit-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
section.main .content .front-matter .tags ul li:hover {
  opacity: 0.7;
}
section.main .content .front-matter .tags ul li a {
  color: #666666;
}
section.main .container.f04 {
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
}
section.main .container.f04 .content {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
section.main .container.f04 .content .num {
  margin: 30px 0px 30px 0;
  font-weight: 400;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  font-size: 50px;
}
section.main .container.f04 .content .detail {
  margin-bottom: 40px;
}
section.main .container .content .groupby {
  margin-top: 1em;
  padding-left: 0.5em;
}
section.main .container .content .post-item {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  display: list-item;
  list-style: disc inside;
}
section.main .container .content .post-item .meta {
  font-size: 14px;
  color: #666666;
  display: none;
  min-width: 100px;
}
section.main .container .content .see-more {
  font-style: italic;
  float: right;
  font-size: 0.9em;
  margin-top: 2em;
  color: #313537;
}
section.main .container .content .see-more:hover {
  color: #666;
}
section {
  padding: 0 16px;
}
section.header {
  padding-top: 10px;
}
section.header-home {
  padding-top: 36px;
}
section.main {
  padding-top: 32px;
}
section.main .container .content .post-item .meta {
    display: block;
}
section.main .container .content .post-item {
    display: flex;
    list-style: none;
}
a {
  color: #428bca;
  -webkit-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
a:hover {
  color: #2a6496;
}
img {
  max-width: 100%;
}
section.main .content {
    width: 100%;
}
section.main .content .markdown {
  font-size: 1.1em;
  line-height: 1.75em;
  color: #313537;
  font-family: serif;
  font-weight: 300;
}
section.main .content .markdown h1,
section.main .content .markdown h2,
section.main .content .markdown h3,
section.main .content .markdown h4,
section.main .content .markdown h5,
section.main .content .markdown h6 {
  font-size: 22px;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  font-weight: 700;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
  text-transform: none;
  margin-top: 1.75rem;
}
section.main .content .markdown h1 {
  font-size: 1.75rem;
  margin-bottom: 2rem;
}
section.main .content .markdown h2 {
  font-size: 1.5rem;
  margin-bottom: 1.5rem;
}
section.main .content .markdown h3 {
  font-size: 1em;
  margin-bottom: 1rem;
}
section.main .content .markdown h4,
section.main .content .markdown h5,
section.main .content .markdown h6 {
  font-size: 1rem;
  margin-bottom: 1rem;
  letter-spacing: none;
}
section.main .content .markdown code,
section.main .content .markdown pre {
  font-family: 'Menlo', monospace;
  font-size: 0.98rem;
  background-color: #f7f7f7;
}
section.main .content .markdown code {
  /* enclosed by single backtick (`) */
  padding: .15em .5em;
  border-radius: 2px;
}
section.main .content .markdown pre {
  /* Hugo specific: consider using the 'highlight' shortcode */
  display: block;
  margin-top: 1rem;
  margin-bottom: 2rem;
  padding: 1rem;
  line-height: 1.5em;
  white-space: pre;
  word-break: break-all;
  word-wrap: break-word;
}
section.main .content .markdown pre code {
  /* enclosed by 4 backticks (````) */
  padding: 0;
  font-size: 0.9rem;
}
section.main .content .markdown a code {
  color: #428bca !important;
}
section.main .content .markdown a code:hover {
  text-decoration: underline;
}
section.main .content .markdown p {
  text-align: justify;
  margin-top: 0;
  margin-bottom: 1em;
}
section.main .content .markdown ul,
section.main .content .markdown ol,
section.main .content .markdown dl {
  margin-top: 1rem;
  margin-bottom: 2rem;
}
section.main .content .markdown dt {
  font-weight: bold;
}
section.main .content .markdown dd {
  margin-bottom: .5rem;
}
section.main .content .markdown ul {
  list-style-type: disc;
  list-style-position: outside;
  margin-bottom: 1.25rem;
}
section.main .content .markdown ol {
  list-style-type: decimal;
  margin-bottom: 1.25rem;
}
section.main .content .markdown li {
  margin-left: 2em;
}
section.main .content .markdown em {
  font-style: italic;
}
section.main .content .markdown strong {
  font-weight: 700;
}
section.main .content .markdown hr {
  position: relative;
  margin: 1.75rem 0;
  border: 0;
  border-top: 1px solid #808080;
  border-top: 1px solid #999999;
}
section.main .content .markdown abbr {
  font-size: 0.85rem;
  font-weight: bold;
  color: #666666;
  text-transform: uppercase;
}
section.main .content .markdown abbr[title] {
  cursor: help;
  border-bottom: 1px dotted #808080;
}
section.main .content .markdown blockquote {
  padding: .5rem 1rem;
  margin: .8rem 0;
  color: #7a7a7a;
  border-left: .25rem solid #e5e5e5;
}
section.main .content .markdown blockquote p:last-child {
  margin-bottom: 0;
}
section.main .content .markdown figure {
  width: 100%;
  background: #fff;
  margin-bottom: 1em;
}
section.main .content .markdown figure img {
  width: 100%;
  height: auto;
  max-width: 100%;
  display: block;
  position: static;
  margin: auto;
}
section.main .content .markdown table {
  margin-bottom: 1rem;
  width: 100%;
  border: 1px solid #e5e5e5;
  border-collapse: collapse;
}
section.main .content .markdown td,
section.main .content .markdown th {
  padding: .25rem .5rem;
  border: 1px solid #e5e5e5;
}
section.main .content .markdown tbody tr:nth-child(odd) td,
section.main .content .markdown tbody tr:nth-child(odd) th {
  background-color: #f7f7f7;
}
section.main .content .markdown .footnotes ol {
  list-style-type: decimal;
  margin-left: 16px;
}
section.main .content .markdown .footnotes li {
  list-style-type: unset;
}
section.main .content .markdown .footnote-ref {
  font-size: 0.7em;
}
section.main .content .navigation {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  padding: 2em;
}
section.main .content .navigation div {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  margin-top: 1em;
}
section.main .content .navigation .icon {
  width: 16px;
  height: 16px;
}
section.main .content .navigation a {
  width: 250px;
  margin: 0 1em;
  text-align: center;
  font-style: italic;
  color: #313537;
}
section.main .content .share, section.main .content .share div {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  justify-content: center;
}
section.main .content .share {
  background-color: rgba(152, 152, 152, 0.07);
  padding: 1em 0;
}
section.main .content .share a {
  margin: 0 6px;
}

/* Fonts */

.wf-raleway-n4-active body, 
.wf-raleway-n4-active section.header nav ul li,
.wf-raleway-n7-active section.main .content .page-heading,
.wf-raleway-n2-active section.main .container.f04 .content .num,
.wf-raleway-n7-active section.main .content .markdown h1,
.wf-raleway-n7-active section.main .content .markdown h2,
.wf-raleway-n7-active section.main .content .markdown h3,
.wf-raleway-n7-active section.main .content .markdown h4,
.wf-raleway-n7-active section.main .content .markdown h5,
.wf-raleway-n7-active section.main .content .markdown h6 {
  font-family: 'Raleway';
}

.wf-merriweather-n3-active section.main .content .markdown {
  font-family: 'Merriweather';
}

.wf-ubuntu-mono-n4-active section.main .content .markdown code,
.wf-ubuntu-mono-n4-active section.main .content .markdown pre {
  font-family: 'Ubuntu Mono';
}
</style>
<style media="(min-width: 600px)">
  body {
-webkit-justify-content: center;
-moz-justify-content: center;
-ms-justify-content: center;
justify-content: center;
}
.non-narrow.zero-top-spacing {
padding-top: 0 !important;
}
section {
padding: 0 16px;
margin-left: 100px;
margin-right: 100px;
max-width: 750px;
}
section.header {
background-color: transparent;
}
section.header .container {
-webkit-justify-content: flex-start;
-moz-justify-content: flex-start;
-ms-justify-content: flex-start;
justify-content: flex-start;
}
section.header .container .logo {
margin: 0;
}
section.header-home .container .logo {
max-width: 180px;
margin-left: 20px;
}
section.header-home .name-home {
padding-top: 30px;
font-size: 40px;
}
section.header-home nav ul li {
font-size: 18px;
}
section.header .content {
-webkit-align-items: flex-start;
-moz-align-items: flex-start;
-ms-align-items: flex-start;
align-items: flex-start;
}
section.header .name {
color: #333333;
}
section.header nav {
font-size: 14px;
margin-bottom: 0;
}
section.header nav ul {
text-align: left;
}
section.header nav ul li {
color: #666666;
}
section.header nav ul li:hover {
color: #333333;
}
section.footer {
background-color: transparent;
}
section.footer .container {
flex-direction: row;
}
section.footer .container a {
margin-left: 3px;
margin-right: 3px;
color: #666666;
}
section.footer .container a:hover {
color: #333333;
}
section.footer .container a .icon {
font-size: 18px;
}
section.footer .container a .icon.larger {
font-size: 20px;
}
section.main .content .front-matter .date,
section.main .content .front-matter .author,
section.main .content .front-matter .tags,
section.main .content .front-matter .word-count,
section.main .content .front-matter .reading-time .middot {
display: initial;
}
section.main .container.f04 {
-webkit-justify-content: flex-start;
-moz-justify-content: flex-start;
-ms-justify-content: flex-start;
justify-content: flex-start;
}
section.main .container.f04 .content {
-webkit-align-items: flex-start;
-moz-align-items: flex-start;
-ms-align-items: flex-start;
align-items: flex-start;
}
section.main .container.f04 .content .num {
margin: 0 0 10px 0;
font-size: 32px;
}
section.main .container.f04 .content .detail {
margin-bottom: 30px;
}
.container {
padding: 0 30px;
}
section.header {
padding-top: 60px;
padding-bottom: 60px;
}
section.footer {
padding-top: 30px;
padding-bottom: 60px;
}
section.main {
padding-top: 0;
}
section.main .container .content .post-item {
display: flex;
list-style: none;
padding-left: 1.5em;
}
section.main .container .content .post-item .meta {
display: block;
}
section.main.post {
padding-top: 60px;
padding-bottom: 60px;
}
section.main .content .markdown blockquote {
padding-right: 5rem;
padding-left: 1.25rem;
}
section.main .content .navigation {
-webkit-flex-direction: row;
-moz-flex-direction: row;
-ms-flex-direction: row;
flex-direction: row;
}
section.main .content .navigation div {
margin-top: 0em;
}
</style>
<style media="(min-width: 769px)">
  section.main .content .markdown figure {
width: 110%;
margin-left: -4%;
}
section.main .content .markdown img {
max-width: 110%;
width: 110%;
margin-left: -4%;
}
section.main .content .markdown pre {
width: 110%;
margin-left: -4%;
}
</style>

<noscript>
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700" rel="stylesheet">
</noscript>


  <style type="text/css" media="screen">
    .hljs{display:block;background:white;padding:0.5em;color:#333333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-string,.hljs-variable,.hljs-template-variable,.hljs-strong,.hljs-emphasis,.hljs-quote{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-literal,.hljs-symbol,.hljs-bullet,.hljs-attribute{color:#0086b3}.hljs-section,.hljs-name{color:#63a35c}.hljs-tag{color:#333333}.hljs-title,.hljs-attr,.hljs-selector-id,.hljs-selector-class,.hljs-selector-attr,.hljs-selector-pseudo{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}
  </style>













<link rel="shortcut icon"

    href="https://asynchronous.in/img/logo.png"

>




</head>


<body>


<section class="header">

    <div class="container">
        <a href="https://asynchronous.in/"><img class="logo" src="https://asynchronous.in/img/logo.png" alt="logo" /></a>
        <div class="content">
            <a href="https://asynchronous.in/"><div class="name"><h1>maxking&#39;s blog</h1></div></a>
            <nav>
                <ul>
                    
                        <a href="https://asynchronous.in/blog/"><li>Blog</li></a>
                    
                    
                        
                            
                        
                    
                    
                        
                            <a href="https://asynchronous.in/notes/"><li>Notes</li></a>
                        
                    
                        
                            <a href="https://asynchronous.in/about/"><li>About</li></a>
                        
                    
                </ul>
            </nav>
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    Rules and Chains

</div>

                </div>
                <div class="meta">
                    <div class="date" title="Jun 30 2013 00:00">Jun 30 2013</div>
                    
                        
                    
                    <div class="reading-time"><div class="middot"></div>3 minute read</div>
                    <div class="tags">
                        <ul>
                          
                            <div class="middot"></div>
                            <li><a href="/tags/gsoc">gsoc</a> </li>
                          
                            <div class="middot"></div>
                            <li><a href="/tags/mailman">mailman</a> </li>
                          
                        </ul>
                    </div>
                    <div class="tags">
                        <ul>
                          
                          
                        </ul>
                    </div>
                </div>
            </div>
            <div class="markdown">
                
    <p>This post talks about the basic messaging flow in mailman and then a little
detail about what are rules and chains in Mailman. So a message can be injected
in mailman system using a LMTP server via
LMTP. <a href="http://tools.ietf.org/html/rfc2033#section-4">LMTP</a>(Local Mail
Transfer Protocol) is a derivative of ESMTP(Extended SMTP), which is a extension
of well known SMTP(Simple Mail Transfer Protocol). LMTP runner parses the
message into a tuple of type (mailing_list, message, message_data) and stores it
in a serialized form
called <a href="http://docs.python.org/2/library/pickle.html">python
pickle(.pck)</a> file, which is then queued in either one of <i>incoming queue,
bounce queue or command processing queue</i>. If the message parsing fails then
it is discarded. Queues are nothing but a set of directories managed
by <i>switchboards</i>, where all the messages are stored till a <i>runner</i>
wakes up and sends them one by one for processing according to the queue that
they were queued in, e.g. IN runner sends to file to pipeline queue where i
Below is a graph is decided if the message will be accepted, discarded or held
for moderation. Below is a graph depicting the message flow in mailman.</p>
<center>
  <img src="/images/mailman-messaging-flow.png" height="400px">
</center>
<p>How is it decided if a message is 'fit' for posting? This process is
called <i>Moderation</i> where a message is tested against a set of rules. Rules
are simple checks which return True if the rule hits and False in-case it
misses. Moderation does not change anything in message, but it may record the
processing information(like rule hits and misses) information in a metadata
dictionary. Each rule has the following structure:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #a6e22e">@implementer</span><span style="color: #f8f8f2">(IRule)</span>
<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">New_Rule</span><span style="color: #f8f8f2">:</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">check</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">mlist,</span> <span style="color: #f8f8f2">msg,</span> <span style="color: #f8f8f2">msgdata):</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">foo</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">foobar:</span>
            <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">True</span>
        <span style="color: #66d9ef">else</span><span style="color: #f8f8f2">:</span>
            <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">False</span>
</pre></div>

<p>
You can write your own rules to check whatever criteria you want mailman to
check before accepting the message. All the rules reside
inside <b>/src/mailman/rules/</b> in mailman source code. All of the rules are
arranged in a sequential manner to create a <b>chain</b>. Each list has two
default start chains associated with it - first for normal postings and second
one is for admin postings. The incoming runner checks who the message is
addressed to and accordingly the moderation occurs for admin or normal postings.
</p>

<p>The <b>default-builtin-chain</b> has a predefined list of rules to check
before the message is discarded, held or accepted. In mailman3 the list is as
follows in the order in which they are called:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">    <span style="color: #f8f8f2">_link_descriptions</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">(</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;approved&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">jump,</span> <span style="color: #e6db74">&#39;accept&#39;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;emergency&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">jump,</span> <span style="color: #e6db74">&#39;hold&#39;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;loop&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">jump,</span> <span style="color: #e6db74">&#39;discard&#39;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #75715e"># Determine whether the member or nonmember has an action shortcut.</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;member-moderation&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">jump,</span> <span style="color: #e6db74">&#39;moderation&#39;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #75715e"># Do all of the following before deciding whether to hold the message.</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;signature&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">jump,</span> <span style="color: #e6db74">&#39;discard&#39;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;administrivia&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">defer,</span> <span style="color: #f8f8f2">None),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;implicit-dest&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">defer,</span> <span style="color: #f8f8f2">None),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;max-recipients&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">defer,</span> <span style="color: #f8f8f2">None),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;max-size&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">defer,</span> <span style="color: #f8f8f2">None),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;news-moderation&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">defer,</span> <span style="color: #f8f8f2">None),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;no-subject&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">defer,</span> <span style="color: #f8f8f2">None),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;suspicious-header&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">defer,</span> <span style="color: #f8f8f2">None),</span>
        <span style="color: #75715e"># Now if any of the above hit, jump to the hold chain.</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;any&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">jump,</span> <span style="color: #e6db74">&#39;hold&#39;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #75715e"># Take a detour through the header matching chain, which we&#39;ll create</span>
        <span style="color: #75715e"># later.</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;truth&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">detour,</span> <span style="color: #e6db74">&#39;header-match&#39;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #75715e"># Check for nonmember moderation.</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;nonmember-moderation&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">jump,</span> <span style="color: #e6db74">&#39;moderation&#39;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #75715e"># Finally, the builtin chain jumps to acceptance.</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;truth&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">LinkAction</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">jump,</span> <span style="color: #e6db74">&#39;accept&#39;</span><span style="color: #f8f8f2">),</span>
     <span style="color: #f8f8f2">)</span>
</pre></div>


<p>In the above list each entry consists of a tuple of the
form <span class="inline-code"> ('rule_name', LinkAction.action,
'target')</span>. The first element ,as evident from the name, is the name of
the rule that is to be called, the second element tell about what action is
taken if the rule hits(or return True). The last part is the target queue to
which the message is copied to if the rule hits(or you may customise it of course
for when rule misses), it is `None` incase the rule does not have
action. According to your convenience you can create your own chains. In the
above list the <b>signature</b> rule is the one I added to check for
openpgp-signature.
</p>



                <br>
            </div>
            
            
                <div class="navigation">
                    
                    <div>
                        <img class="icon" src="/img/back.svg" alt="back" />
                        <a href="https://asynchronous.in/2013/06/12/gosc-into/">Gsoc 2013 - Pilot!</a>
                    </div>
                    
                    <div style="width: 100%;"></div>
                    
                    <div>
                        <a href="https://asynchronous.in/2013/07/16/stuck-at-gnupg/">GNUPG and python</a>
                        <img class="icon" src="/img/next.svg" alt="next" />
                    </div>
                    
                </div>
            
            <br>
            <div class="disqus">
                
            </div>
            
        </div>
    </div>
</section>

<section class="footer">
    <div class="container">

        

        <div class="copyright">

        

        </div>
        <div class="icons">

        

        
            <a href="https://github.com/maxking" target="_blank">
                <img class="icon" src="/img/github.svg" alt="github" />
            </a>
        

        
            <a href="https://twitter.com/_maxking_" target="_blank">
                <img class="icon" src="/img/twitter.svg" alt="twitter" />
            </a>
        

        

        

        
            <a href="https://asynchronous.in/index.xml">
                <img class="icon" src="/img/rss.svg" alt="rss" />
            </a>
        

        </div>
    </div>
</section>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Raleway:400,600,700', 'Merriweather:300,300i,700,700i', 'Ubuntu+Mono:400,700']
    }
  });
</script>


  <script src="https://asynchronous.in/js/highlight.min.js" defer></script>
  











<script>
  window.onload = function() {
    
      hljs.initHighlighting();
    
    
    
  };
</script>


</body>
</html>

