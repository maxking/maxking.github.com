<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Structure of Email</title><meta name=description content="Ramblings and tech things"><meta name=keywords content><meta property="og:url" content="https://asynchronous.in/2013/09/12/message-structure/"><meta property="og:type" content="website"><meta property="og:title" content="Structure of Email"><meta property="og:description" content="Ramblings and tech things"><meta property="og:image" content="https://asynchronous.in"><meta property="og:image:secure_url" content="https://asynchronous.in"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Structure of Email"><meta name=twitter:description content="Ramblings and tech things"><meta property="twitter:domain" content="https://asynchronous.in/2013/09/12/message-structure/"><meta property="twitter:url" content="https://asynchronous.in/2013/09/12/message-structure/"><meta name=twitter:image content="https://asynchronous.in"><link rel=canonical href=https://asynchronous.in/2013/09/12/message-structure/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.edd985581bf860dfb4507e5885197f1680160c7fe19f23b31e183126d99dd596.js integrity="sha256-7dmFWBv4YN+0UH5YhRl/FoAWDH/hnyOzHhgxJtmd1ZY="></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=https://asynchronous.in>maxking's blog</a></div><div class=nav-links><div class=nav-link><a href=https://asynchronous.in/posts/>Posts</a></div><div class=nav-link><a href=https://asynchronous.in/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/maxking><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://asynchronous.in/posts/>Posts</a></li><li class=nav-item><a href=https://asynchronous.in/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/maxking><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Structure of Email</h1><small role=doc-subtitle></small><p class=post-date>September 12, 2013</p><ul class=post-tags></ul></div><div class=post-content><p><p>This week I was busy investigating which kind of email does MUAs accept and
display nicely. Now wait! What does *kind of email* and *MUA* mean?</p><p>Emails that you use everyday are of various types, much more than you would
have though before. There are emails which can remove styling depending on the
mail client where you are viewing the email. The email clients are generally
called as MUA(Mail User Agent). Now as per decided before we were planning to
send out signed emails which had signature from both sender and mailman. The
structure of a normal `pgp-signed` message is:<pre>
multipart/signed
    text/plain
    application/pgp-signature
</pre>But this structure as you can see can with-hold only one signature part,
ofcourse if you strictly follow
<a href=https://tools.ietf.org/html/rfc3156>rfc3156 </a>. So we tried to
deviate a bit from convention and tried out a few more structures like below:<pre>
multipart/signed
    text/plain
    multipart/mixed
       application/pgp-signature
       application/pgp-signature
</pre>The above structure does not work with my MUA for the reason that my
MUA(<a href=http://www.djcbsoftware.nl/code/mu/mu4e.html>mu4e</a>) fails to
find any signature part inside the email as it gets an 'multipart/mixed' type
instead of 'application/pgp-signature'.<pre>
multipart/alternative
    multipart/signed
       text/plain
       application/pgp-signature
    multipart/signed
       text/plain
       application/pgp-signature
</pre>This part was recognized well by my MUA but it got confused to display which
type. Usually 'multipart/alternative' emails are made so that MUA selects the
best suited type it supports and display that part, but here it gets confused as
technically both parts have same type(only different signatures). So it
displayed both the parts one-after-another.Bah.<pre>
mutipart/signed
   text/plain
   application/pgp-signature
   application/pgp-signature
</pre>This was one of the types where I inserted an extra signature part in the
original message. My MUA was although able to show both signatures, I am trying
to test all the three types with various other MUAs and then finally decide.</p><b>EDIT</b><br><p>Finally we came up with another idea which was according to rfc as
well got verified in some of the MUAs that we tried, it goes like following:</p><pre>
multipart/signed
    multipart/mixed
       multipart/signed
           text/plain
           application/pgp-signature
       text/plain
    application/pgp-signature
</pre><p>In the above structure we have a multipart/mixed part which is actually
produces by mailman as of now, but from now(if my code is merged to the main
trunk) on it will be further modified to created a multipart/signed message
where whole multipart/mixed part is faltened and signature is calculate over the
whole part.<p></p></div><div class=prev-next></div><script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function topFunction(){smoothScrollToTop()}function smoothScrollToTop(){const e=()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;t>0&&(window.requestAnimationFrame(e),window.scrollTo(0,t-t/8))};e()}</script></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>