<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Basic GDB</title><meta name=description content="Ramblings and tech things"><meta name=keywords content><meta property="og:url" content="https://asynchronous.in/2016/03/17/gdb-intro/"><meta property="og:type" content="website"><meta property="og:title" content="Basic GDB"><meta property="og:description" content="Ramblings and tech things"><meta property="og:image" content="https://asynchronous.in"><meta property="og:image:secure_url" content="https://asynchronous.in"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Basic GDB"><meta name=twitter:description content="Ramblings and tech things"><meta property="twitter:domain" content="https://asynchronous.in/2016/03/17/gdb-intro/"><meta property="twitter:url" content="https://asynchronous.in/2016/03/17/gdb-intro/"><meta name=twitter:image content="https://asynchronous.in"><link rel=canonical href=https://asynchronous.in/2016/03/17/gdb-intro/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.edd985581bf860dfb4507e5885197f1680160c7fe19f23b31e183126d99dd596.js integrity="sha256-7dmFWBv4YN+0UH5YhRl/FoAWDH/hnyOzHhgxJtmd1ZY="></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=https://asynchronous.in>maxking's blog</a></div><div class=nav-links><div class=nav-link><a href=https://asynchronous.in/posts/>Posts</a></div><div class=nav-link><a href=https://asynchronous.in/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/maxking><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://asynchronous.in/posts/>Posts</a></li><li class=nav-item><a href=https://asynchronous.in/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/maxking><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Basic GDB</h1><small role=doc-subtitle></small><p class=post-date>March 17, 2016</p><ul class=post-tags></ul></div><div class=post-content><p><p><a href=https://www.gnu.org/s/gdb/>GDB</a>(The GNU Project Debugger) is one of the most awesome softwares ever
built for C programmers. I recently started to write some code in C,
specifically trying out socket programming and some other stuff. I had a very
basic problem about how to debug a variable (bytes) without using the
<code>printf</code>. I have been using <code>printf</code> since always to debug softwares in C and
Python, but lets see something new today.</p><p>First, lets see a very simple socket program:</p><p>To compile this program with debugging symbols(-g) that gdb can use, try:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ gcc -o server -g server.c
</span></span></code></pre></div><p>Then you can run your program:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ ./server <span class=m>2000</span>
</span></span></code></pre></div><p>You can then also test that your server works using <code>telnet</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ telnet localhost <span class=m>2000</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>Trying 127.0.0.1...
</span></span><span class=line><span class=ln>3</span><span class=cl>Connected to localhost.
</span></span><span class=line><span class=ln>4</span><span class=cl>Escape character is <span class=s1>&#39;^]&#39;</span>.
</span></span><span class=line><span class=ln>5</span><span class=cl>hi
</span></span><span class=line><span class=ln>6</span><span class=cl>I got your message
</span></span></code></pre></div><p>Great Work! Now, my next problem was trying to close the connection with the
client if it sent an &ldquo;exit&rdquo;. Not a problem, I just compared the read buffer
against the string &ldquo;exit&rdquo; and expected it to work.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=s>&#34;exit&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>n</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>	<span class=k>break</span><span class=p>;</span>
</span></span></code></pre></div><p>But, unfortunately this did not work for some reason I could not reason
about. So, lets see how we can debug this using gdb. First of all you run your
program using gdb after compiling with debug symbols( option -g):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ gdb ./server
</span></span><span class=line><span class=ln>2</span><span class=cl>...
</span></span><span class=line><span class=ln>3</span><span class=cl>...
</span></span><span class=line><span class=ln>4</span><span class=cl>Reading symbols from server...done.
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=o>(</span>gdb<span class=o>)</span>
</span></span></code></pre></div><p>Great, now you can start introducing breakpoints in your program like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>break</span> server.c:78
</span></span><span class=line><span class=ln>2</span><span class=cl>Breakpoint <span class=m>1</span> at 0x400d00: file server.c, line 78.
</span></span></code></pre></div><p>This added a breakpoint at the line 78 in your program. Remember, this is your
source code and not the compiled program. You can&rsquo;t make sense out of your
compiled program anyway.</p><p>So, what exactly is a breakpoint? It is simply a marker
that you set where you want the execution of your program to halt, so that you
can analyse the state and variables instead of priting all of them one by one in
the source code.Now lets see how that exactly works:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>(</span>gdb<span class=o>)</span> run <span class=m>3000</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>Starting program: &lt;path_to&gt;/server <span class=m>3003</span>
</span></span></code></pre></div><p>Now when the execution reaches line 78, we should see a gdb prompt and program
execution should pause.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ telnet localhost <span class=m>3000</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>Trying 127.0.0.1...
</span></span><span class=line><span class=ln>3</span><span class=cl>Connected to localhost.
</span></span><span class=line><span class=ln>4</span><span class=cl>Escape character is <span class=s1>&#39;^]&#39;</span>.
</span></span><span class=line><span class=ln>5</span><span class=cl>hi
</span></span><span class=line><span class=ln>6</span><span class=cl>I got your message
</span></span></code></pre></div><p>Wait, what happened? Why did the program not hault? A quick google search led me
to the conclusion that gdb monitors the main parent process by default, even if
you execute a <code>fork()</code> system call. This means, that the breakpoint should be
introduced in the child process as the main parent process never runs the line
78 we introduced break point on. Lets now change that and again run the server
and try connecting from a client.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>$ gdb ./server
</span></span><span class=line><span class=ln> 2</span><span class=cl>....
</span></span><span class=line><span class=ln> 3</span><span class=cl>....
</span></span><span class=line><span class=ln> 4</span><span class=cl>Reading symbols from server...done.
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>set</span> follow-fork-mode child
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=o>(</span>gdb<span class=o>)</span> <span class=nb>break</span> server.c:78
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=o>(</span>gdb<span class=o>)</span> run <span class=m>3000</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>Starting program: /home/maxking/Documents/socket-prog/server <span class=m>3000</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=o>[</span>New process 8940<span class=o>]</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>Breakpoint 1, dostuff <span class=o>(</span><span class=nv>newsockfd</span><span class=o>=</span>4<span class=o>)</span> at server.c:78
</span></span><span class=line><span class=ln>12</span><span class=cl>78					<span class=nv>n</span> <span class=o>=</span> strcmp<span class=o>(</span>strtok<span class=o>(</span>buffer, <span class=s2>&#34;\r\n&#34;</span><span class=o>)</span>, <span class=nb>exit</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=o>(</span>gdb<span class=o>)</span>print buffer
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nv>$1</span> <span class=o>=</span> <span class=s2>&#34;yo\r\n&#34;</span>, <span class=s1>&#39;\000&#39;</span> &lt;repeats <span class=m>251</span> times&gt;
</span></span></code></pre></div><p>Awesome! Now, I guess you already know why &ldquo;exit&rdquo; string does not match with
<code>buffer</code>, because the client(telnet) added &ldquo;\r\n&rdquo; at the end of the message.</p><p>We can easily remove that using <code>strtok()</code> method to strip them off:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=nf>strtok</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=s>&#34;</span><span class=se>\r\n</span><span class=s>&#34;</span><span class=p>),</span> <span class=n>exit</span><span class=p>);</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>n</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>	<span class=k>break</span><span class=p>;</span>
</span></span></code></pre></div><p>And, if you run this, you&rsquo;d know that it does work! GDB is actually much more
useful than just printing stuff. <a href=http://www.unknownroad.com/rtfm/gdbtut/>Here</a> is a great tutorial that you can
refer to learn more about how to use the advanced features of gdb.</p></p></div><div class=prev-next></div><script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function topFunction(){smoothScrollToTop()}function smoothScrollToTop(){const e=()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;t>0&&(window.requestAnimationFrame(e),window.scrollTo(0,t-t/8))};e()}</script></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>